#!/bin/bash
set -e

# Get latest URL from here:
#    https://scan.coverity.com/download

SCAN_TOOL=https://scan.coverity.com/build_tool/cov-analysis-linux32-6.5.1.tar.gz

TOOL_BASE=/tmp/coverity-scan
if [ -d $TOOL_BASE ];
then
  echo "found existing $TOOL_BASE - aborting!"
  exit 1
fi

mkdir -p $TOOL_BASE

cd $TOOL_BASE
wget -O coverity_tool.tgz $SCAN_TOOL
tar xzf coverity_tool.tgz

TOOL_DIR=`find $TOOL_BASE -type d -name 'cov-analysis*'`
ln -s $TOOL_DIR $TOOL_BASE/cov-analysis

echo "Coverity home = $TOOL_BASE/cov-analysis"
ls -l $TOOL_BASE/cov-analysis

echo "Coverity install done."

